{% extends 'base.html' %}
{% load widget_tweaks %}

{% block title %}Danh mục tài chính - NavyBaby{% endblock %}
{% block navbar_icon %}wallet{% endblock %}
{% block navbar_title %}Tài chính{% endblock %}

{% block content %}
<div class="sticky-subheader flex flex-col md:flex-row justify-between items-center mb-6 py-3">
  <div>
    <h2 class="text-2xl font-bold flex items-center text-blue-400">
      <i data-lucide="tags" class="w-6 h-6 mr-2"></i>Danh mục tài chính
    </h2>
    <p class="text-gray-400">Quản lý loại Khoản thu/Khoản chi</p>
  </div>
  <div class="flex items-center gap-2">
    <a href="{% url 'finance:category_create' %}" class="px-3 py-1.5 rounded-md border text-sm transition bg-blue-600 text-white border-blue-700 hover:bg-blue-500 flex items-center">
      <i data-lucide="plus" class="w-4 h-4 mr-1"></i>Thêm danh mục
    </a>
    <a href="{% url 'finance:transactions_list' %}" class="px-3 py-1.5 rounded-md border text-sm transition bg-[#161616] text-gray-300 border-gray-800 hover:border-gray-700 flex items-center">
      <i data-lucide="list" class="w-4 h-4 mr-1"></i>Nhật ký giao dịch
    </a>
  </div>
</div>
{% if is_paginated %}
<div class="mt-6 flex flex-col sm:flex-row items-center justify-between gap-3 text-sm">
  <div class="text-gray-400">
    Trang <span class="text-gray-200 font-medium">{{ page_obj.number }}</span> / {{ page_obj.paginator.num_pages }} · Tổng <span class="text-gray-200 font-medium">{{ page_obj.paginator.count }}</span>
  </div>
  <div class="flex items-center gap-1">
    {% if page_obj.has_previous %}
      <a class="px-2 py-1 rounded border border-gray-800 bg-[#161616] text-gray-300 hover:border-gray-700" href="?{% if request.GET %}{{ request.GET.urlencode }}&{% endif %}page=1">« Đầu</a>
      <a class="px-2 py-1 rounded border border-gray-800 bg-[#161616] text-gray-300 hover:border-gray-700" href="?{% if request.GET %}{{ request.GET.urlencode }}&{% endif %}page={{ page_obj.previous_page_number }}">‹ Trước</a>
    {% else %}
      <span class="px-2 py-1 rounded border border-gray-900 bg-[#111] text-gray-600">« Đầu</span>
      <span class="px-2 py-1 rounded border border-gray-900 bg-[#111] text-gray-600">‹ Trước</span>
    {% endif %}

    {% for i in page_obj.paginator.page_range %}
      {% if i >= page_obj.number|add:-2 and i <= page_obj.number|add:2 %}
        {% if page_obj.number == i %}
          <span class="px-3 py-1 rounded border border-blue-800 bg-blue-900/30 text-blue-300">{{ i }}</span>
        {% else %}
          <a class="px-3 py-1 rounded border border-gray-800 bg-[#161616] text-gray-300 hover:border-gray-700" href="?{% if request.GET %}{{ request.GET.urlencode }}&{% endif %}page={{ i }}">{{ i }}</a>
        {% endif %}
      {% endif %}
    {% endfor %}

    {% if page_obj.has_next %}
      <a class="px-2 py-1 rounded border border-gray-800 bg-[#161616] text-gray-300 hover:border-gray-700" href="?{% if request.GET %}{{ request.GET.urlencode }}&{% endif %}page={{ page_obj.next_page_number }}">Tiếp ›</a>
      <a class="px-2 py-1 rounded border border-gray-800 bg-[#161616] text-gray-300 hover:border-gray-700" href="?{% if request.GET %}{{ request.GET.urlencode }}&{% endif %}page={{ page_obj.paginator.num_pages }}">Cuối »</a>
    {% else %}
      <span class="px-2 py-1 rounded border border-gray-900 bg-[#111] text-gray-600">Tiếp ›</span>
      <span class="px-2 py-1 rounded border border-gray-900 bg-[#111] text-gray-600">Cuối »</span>
    {% endif %}
  </div>
</div>
{% endif %}

<div class="bg-[#121212] border border-gray-800 rounded-lg p-4 mb-4">
  <form method="get" class="grid grid-cols-1 md:grid-cols-3 gap-3">
    <input type="text" name="q" value="{{ q }}" placeholder="Tìm tên/mô tả..." class="w-full bg-[#161616] border border-gray-800 rounded-md px-3 py-2 text-gray-200" />
    <select name="type" class="w-full bg-[#161616] border border-gray-800 rounded-md px-3 py-2 text-gray-200">
      <option value="">-- Tất cả loại --</option>
      <option value="INCOME" {% if type == 'INCOME' %}selected{% endif %}>Khoản thu</option>
      <option value="EXPENSE" {% if type == 'EXPENSE' %}selected{% endif %}>Khoản chi</option>
    </select>
    <div class="flex gap-2">
      <button type="submit" class="px-3 py-2 rounded-md border text-sm bg-blue-600 text-white border-blue-700 hover:bg-blue-500">Lọc</button>
      <a href="{% url 'finance:category_list' %}" class="px-3 py-2 rounded-md border text-sm bg-[#161616] text-gray-300 border-gray-800 hover:border-gray-700">Xóa lọc</a>
    </div>
  </form>
</div>

<div class="bg-[#121212] border border-gray-800 rounded-lg overflow-hidden">
  <div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-800">
      <thead class="bg-[#161616]">
        <tr>
          <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Loại</th>
          <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Tên</th>
          <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Mô tả</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-800">
        {% for c in categories %}
          <tr class="hover:bg-[#171717]">
            <td class="px-4 py-3">
              {% if c.type == 'INCOME' %}
                <span class="text-[11px] px-1.5 py-0.5 rounded bg-green-900/30 border border-green-800 text-green-300">Khoản thu</span>
              {% else %}
                <span class="text-[11px] px-1.5 py-0.5 rounded bg-red-900/30 border border-red-800 text-red-300">Khoản chi</span>
              {% endif %}
            </td>
            <td class="px-4 py-3 text-gray-200">
              <a href="{% url 'finance:category_update' c.pk %}" class="text-blue-400 hover:text-blue-300 hover:underline underline-offset-2">{{ c.name }}</a>
            </td>
            <td class="px-4 py-3 text-gray-300">{{ c.description|default:'-' }}</td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="3" class="px-4 py-6 text-center text-gray-400">Chưa có danh mục nào.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>lucide.createIcons();</script>
{% endblock %}
