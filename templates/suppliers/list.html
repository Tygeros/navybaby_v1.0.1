{% extends 'base.html' %}
{% block title %}{{ title|default:'Nhà cung cấp - NavyBaby' }}{% endblock %}
{% block navbar_icon %}truck{% endblock %}
{% block navbar_title %}Nhà cung cấp{% endblock %}

{% block content %}
<!-- Header -->
<div class="sticky-subheader flex flex-col md:flex-row justify-between items-center mb-6 py-3">
  <div>
    <h2 class="text-2xl font-bold flex items-center text-blue-400">
      <i data-lucide="truck" class="w-6 h-6 mr-2"></i>Nhà cung cấp
    </h2>
    <p class="text-sm text-gray-400 mt-1">
      {% if action == 'create' %}
        Thêm nhà cung cấp mới
      {% elif action == 'update' %}
        Cập nhật thông tin nhà cung cấp
      {% elif action == 'delete' %}
        Xác nhận xóa nhà cung cấp
      {% else %}
        Danh sách các nhà cung cấp
      {% endif %}
    </p>
  </div>
  {% if action == 'list' %}
  <a href="{% url 'suppliers:supplier_create' %}" class="mt-4 md:mt-0 inline-flex items-center gap-2 bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-md shadow-sm hover:shadow-md ring-1 ring-blue-500/20 transition">
    <i data-lucide="plus" class="w-4 h-4 mr-1"></i>
    Thêm mới
  </a>
  {% endif %}
</div>

{% if action != 'list' %}
<!-- Form Section -->
<div class="bg-[#1a1a1a] border border-gray-800 rounded-lg p-6 mb-6">
  <h3 class="text-lg font-medium text-gray-200 mb-4">
    {% if action == 'create' %}
      Thêm nhà cung cấp mới
    {% elif action == 'update' %}
      Cập nhật thông tin
    {% elif action == 'delete' %}
      Xác nhận xóa
    {% endif %}
  </h3>
  
  {% if action == 'delete' %}
    <p class="text-gray-300 mb-6">Bạn có chắc chắn muốn xóa nhà cung cấp <span class="font-medium text-white">{{ object.name }}</span>? Hành động này không thể hoàn tác.</p>
  {% endif %}

  <form method="post">
    {% csrf_token %}
    
    {% if action != 'delete' %}
      {% for field in form %}
        <div class="mb-4">
          <label class="block text-sm text-gray-400 mb-1">
            {{ field.label }}
            {% if field.field.required %}<span class="text-red-500">*</span>{% endif %}
          </label>
          {{ field }}
          {% if field.help_text %}
            <p class="text-xs text-gray-500 mt-1">{{ field.help_text }}</p>
          {% endif %}
          {% for error in field.errors %}
            <p class="text-red-500 text-xs mt-1">{{ error }}</p>
          {% endfor %}
        </div>
      {% endfor %}
    {% endif %}

    <div class="flex justify-end space-x-3 mt-6">
      <a href="{% url 'suppliers:supplier_list' %}" class="inline-flex items-center px-4 py-2 rounded-md border border-gray-700 text-gray-300 hover:bg-gray-800 hover:border-gray-600 transition">
        Hủy bỏ
      </a>
      <button type="submit" class="{% if action == 'delete' %}bg-red-600 hover:bg-red-700{% else %}bg-blue-600 hover:bg-blue-700{% endif %} text-white px-4 py-2 rounded-md text-sm font-medium transition-colors">
        {% if action == 'create' %}
          Thêm mới
        {% elif action == 'update' %}
          Cập nhật
        {% elif action == 'delete' %}
          Xác nhận xóa
        {% endif %}
      </button>
    </div>
  </form>
</div>
{% endif %}

<!-- Suppliers List -->
<div class="bg-[#121212] border border-gray-800 rounded-lg overflow-hidden">
  <div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-800">
      <thead class="bg-[#161616]">
        <tr>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">
            Mã NCC
          </th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">
            Tên nhà cung cấp
          </th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">
            Ghi chú
          </th>
          <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-400 uppercase tracking-wider">
            Hành động
          </th>
        </tr>
      </thead>
      <tbody class="bg-[#121212] divide-y divide-gray-800">
        {% for supplier in suppliers %}
        <tr class="hover:bg-[#1a1a1a] transition-colors">
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-blue-400">
            {{ supplier.code }}
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">
            {{ supplier.name }}
          </td>
          <td class="px-6 py-4 text-sm text-gray-400">
            {{ supplier.note|default:"-"|truncatechars:50 }}
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
            <a href="{% url 'suppliers:supplier_update' supplier.code %}" class="text-blue-400 hover:text-blue-300 mr-4">
              <i data-lucide="edit" class="w-4 h-4 inline"></i>
            </a>
            <a href="{% url 'suppliers:supplier_delete' supplier.code %}" class="text-red-400 hover:text-red-300">
              <i data-lucide="trash-2" class="w-4 h-4 inline"></i>
            </a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="4" class="px-6 py-4 text-center text-sm text-gray-400">
            Chưa có nhà cung cấp nào. <a href="{% url 'suppliers:supplier_create' %}" class="text-blue-400 hover:underline">Thêm mới</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% if is_paginated %}
<div class="mt-6 flex flex-col sm:flex-row items-center justify-between gap-3 text-sm">
  <div class="text-gray-400">
    Trang <span class="text-gray-200 font-medium">{{ page_obj.number }}</span> / {{ page_obj.paginator.num_pages }} · Tổng <span class="text-gray-200 font-medium">{{ page_obj.paginator.count }}</span>
  </div>
  <div class="flex items-center gap-1">
    {% if page_obj.has_previous %}
      <a class="px-2 py-1 rounded border border-gray-800 bg-[#161616] text-gray-300 hover:border-gray-700" href="?{% if request.GET %}{{ request.GET.urlencode }}&{% endif %}page=1">« Đầu</a>
      <a class="px-2 py-1 rounded border border-gray-800 bg-[#161616] text-gray-300 hover:border-gray-700" href="?{% if request.GET %}{{ request.GET.urlencode }}&{% endif %}page={{ page_obj.previous_page_number }}">‹ Trước</a>
    {% else %}
      <span class="px-2 py-1 rounded border border-gray-900 bg-[#111] text-gray-600">« Đầu</span>
      <span class="px-2 py-1 rounded border border-gray-900 bg-[#111] text-gray-600">‹ Trước</span>
    {% endif %}

    {% for i in page_obj.paginator.page_range %}
      {% if i >= page_obj.number|add:-2 and i <= page_obj.number|add:2 %}
        {% if page_obj.number == i %}
          <span class="px-3 py-1 rounded border border-blue-800 bg-blue-900/30 text-blue-300">{{ i }}</span>
        {% else %}
          <a class="px-3 py-1 rounded border border-gray-800 bg-[#161616] text-gray-300 hover:border-gray-700" href="?{% if request.GET %}{{ request.GET.urlencode }}&{% endif %}page={{ i }}">{{ i }}</a>
        {% endif %}
      {% endif %}
    {% endfor %}

    {% if page_obj.has_next %}
      <a class="px-2 py-1 rounded border border-gray-800 bg-[#161616] text-gray-300 hover:border-gray-700" href="?{% if request.GET %}{{ request.GET.urlencode }}&{% endif %}page={{ page_obj.next_page_number }}">Tiếp ›</a>
      <a class="px-2 py-1 rounded border border-gray-800 bg-[#161616] text-gray-300 hover:border-gray-700" href="?{% if request.GET %}{{ request.GET.urlencode }}&{% endif %}page={{ page_obj.paginator.num_pages }}">Cuối »</a>
    {% else %}
      <span class="px-2 py-1 rounded border border-gray-900 bg-[#111] text-gray-600">Tiếp ›</span>
      <span class="px-2 py-1 rounded border border-gray-900 bg-[#111] text-gray-600">Cuối »</span>
    {% endif %}
  </div>
</div>
{% endif %}

{% endblock %}
